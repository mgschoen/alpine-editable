(()=>{var _o=Object.defineProperty;var ar=(t,e)=>{for(var r in e)_o(t,r,{get:e[r],enumerable:!0})};var l={log:!1,logErrors:!0,editableClass:"js-editable",editableDisabledClass:"js-editable-disabled",pastingAttribute:"data-editable-is-pasting",trimLeadingAndTrailingWhitespaces:!0,boldMarkup:{type:"tag",name:"strong",attribs:{},trim:!0},italicMarkup:{type:"tag",name:"em",attribs:{},trim:!0},underlineMarkup:{type:"tag",name:"u",attribs:{},trim:!1},linkMarkup:{type:"tag",name:"a",attribs:{},trim:!0},pastedHtmlRules:{allowedElements:{a:{href:!0,rel:!0,target:!0},strong:{},em:{},br:{}},allowedPlainTextElements:{br:{}},requiredAttributes:{a:["href"]},transformElements:{b:"strong",i:"em"},splitIntoBlocks:["h1","h2","h3","h4","h5","h6","p","blockquote"],blockLevelElements:["h1","h2","h3","h4","h5","h6","div","p","pre","hr","blockquote","article","figure","header","footer","ul","ol","li","section","table","video"],blacklistedElements:["style","script"],keepInternalRelativeLinks:!1,replaceQuotes:{}}};function S(){if(l.logErrors===!1)return;let t=arguments.length===1?arguments[0]:Array.from(arguments);if(global.console){if(typeof console.error=="function")return console.error(t);console.log(t)}}var W={};ar(W,{getHost:()=>ge,getNodeIndex:()=>Ue,isBeginningOfHost:()=>J,isDocumentFragmentWithoutChildren:()=>ze,isEndOfHost:()=>Ke,isEndOffset:()=>vt,isInlineElement:()=>Po,isLinebreak:()=>Cr,isSameNode:()=>Et,isStartOffset:()=>Tt,isTextEndOfHost:()=>Z,isTextEndOffset:()=>St,isVoid:()=>wt,isVoidTextNode:()=>br,isWhitespaceOnly:()=>yr,lastChild:()=>me,lastOffsetWithContent:()=>Nt,latestChild:()=>Fo});var Mo=Object.prototype.toString,Io={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"};function bt(t){return t.replace(/\s+$/,"")}function de(t){return t.replace(/^\s+|\s+$/g,"")}function yt(t){return Mo.call(t)==="[object String]"}function cr(t,e){return t.replace(e?/[&<>'"]/g:/[&<>]/g,function(r){return Io[r]})}function lr(t,e,r){if(!t)return"";if(t=`${t}`,!e||r==null)return t;let n=t.lastIndexOf(e);return n===-1?t:`${t.slice(0,n)}${r}${t.slice(n+e.length)}`}function ur(t){return/\S+\s{1}$/.test(t)}var T=class{constructor(e,r){this.current=this.previous=this.nextNode=this.root=e,this.iteratorFunc=this[r||"getNext"]}[Symbol.iterator](){return this}getNextTextNode(){let e;for(;e=this.getNext();)if(e.nodeType===3&&e.data!=="")return e}getPreviousTextNode(){let e;for(;e=this.getPrevious();)if(e.nodeType===3&&e.data!=="")return e}next(){let e=this.iteratorFunc();return e?{value:e}:{done:!0}}getNext(){let e=this.current=this.nextNode,r=this.nextNode=void 0;if(this.current)if(r=e.firstChild,r&&e.getAttribute("data-editable")!=="remove")this.nextNode=r;else for(;e!==this.root&&!(this.nextNode=e.nextSibling);)e=e.parentNode;return this.current}getPrevious(){let e=this.current=this.previous,r=this.previous=void 0;if(this.current)if(r=e.lastChild,r&&e.getAttribute("data-editable")!=="remove")this.previous=r;else for(;e!==this.root&&!(this.previous=e.previousSibling);)e=e.parentNode;return this.current}replaceCurrent(e){this.current=e,this.nextNode=void 0,this.previous=void 0;let r=this.current;for(;r!==this.root&&!(this.nextNode=r.nextSibling);)r=r.parentNode}};var M=(t,e)=>typeof t=="string"?Array.from(e.querySelectorAll(t)):t.tagName?[t]:Array.isArray(t)?t:Array.from(t),Ct=(t,e)=>typeof t=="string"?e.querySelector(t):t.tagName?t:t[0]?t[0]:t,He=(t,e=window)=>{let r=e.document.createElement("div");return r.innerHTML=t,r.firstElementChild},Y=(t,e)=>{if(t.closest||(t=t.parentNode),t&&t.closest)return t.closest(e)},m=(t=window)=>t.document.createRange(),We=(t=window)=>t.document.getSelection(),$e=(t,e,r,n=window)=>{let o=[],i=n.document.createNodeIterator(t.commonAncestorContainer,NodeFilter.SHOW_ALL,{acceptNode(a){return t.intersectsNode(a)&&e.includes(a.nodeType)&&a!==t.commonAncestorContainer?typeof r=="function"?r(a)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP:NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}},!1),s;for(;s=i.nextNode();)o.push(s);return o},he=t=>{t.startContainer.compareDocumentPosition(t.endContainer)===Node.DOCUMENT_POSITION_FOLLOWING&&t.setStartBefore(t.endContainer),t.endContainer.compareDocumentPosition(t.startContainer)===Node.DOCUMENT_POSITION_PRECEDING&&t.setEndAfter(t.startContainer)},hr=(t,e)=>t.compareBoundaryPoints(Range.START_TO_START,e)<=0&&t.compareBoundaryPoints(Range.END_TO_END,e)>=0,pr=(t,e)=>{let r=document.createRange();r.selectNodeContents(e);let n=t.compareBoundaryPoints(Range.START_TO_START,r),o=t.compareBoundaryPoints(Range.END_TO_END,r);return n<=0&&o>=0},gr=(t,e)=>{let r=document.createRange();r.selectNodeContents(t);let n=e.compareBoundaryPoints(Range.START_TO_START,r),o=e.compareBoundaryPoints(Range.END_TO_END,r);return n>=0&&o<=0},fr=t=>t&&(t.nodeType===Node.TEXT_NODE||t.nodeType===Node.COMMENT_NODE),dr=(t,e)=>t.splitText(e),mr=t=>{let e=t.startContainer,r=t.startOffset,n=t.endContainer,o=t.endOffset;if(fr(n)&&o>0&&o<n.length&&dr(n,o),fr(e)&&r>0&&r<e.length){let i=dr(e,r);t.setStart(i,0)}},Ve=(t,e)=>{let r=t.cloneRange();r.setStart(e,0),r.setEnd(t.startContainer,t.startOffset);let n=t.toString(),o=r.toString().length,i=o+n.length;return{start:o,end:i,text:n}},qe=(t,e)=>t.startContainer===e.startContainer&&t.startOffset===e.startOffset&&t.endContainer===e.endContainer&&t.endOffset===e.endOffset,xr=(t,e=window)=>{let r=e.document.createElement("div");return r.appendChild(t.cloneContents()),r.innerHTML};function De({root:t,startContainer:e,startOffset:r,whitespacesOnTheLeft:n}){if(!(e.nodeType===3))return De({root:t,startContainer:e.childNodes[r],startOffset:0,whitespacesOnTheLeft:n});let i=r+n;if(e.length>i)return[e,i];let s=new T(t);s.nextNode=e,s.getNextTextNode();let a=s.getNextTextNode();if(!a){let c=s.getPreviousTextNode();return[c,c.length]}return De({root:t,startContainer:a,startOffset:0,whitespacesOnTheLeft:i-e.length})}function je({root:t,endContainer:e,endOffset:r,whitespacesOnTheRight:n}){if(!(e.nodeType===3)){let c=!e.childNodes[r-1],u=c?e.childNodes[r]:e.childNodes[r-1],d=0;return c||(d=u.nodeType===3?u.length:u.childNodes.length),je({root:t,endContainer:u,endOffset:d,whitespacesOnTheRight:n})}let i=r-n;if(i>0)return[e,i];let s=new T(t);s.previous=e,s.getPreviousTextNode();let a=s.getPreviousTextNode();return a?je({root:t,endContainer:a,endOffset:a.length,whitespacesOnTheRight:n-r}):[s.getNextTextNode(),0]}function ge(t){return t=t.jquery?t[0]:t,Y(t,`.${l.editableClass}`)}function Ue(t){let e=0;for(;(t=t.previousSibling)!==null;)e++;return e}function wt(t){for(let e of t.childNodes)if(e.nodeType===3&&!br(e)||e.nodeType===1)return!1;return!0}function br(t){return t.nodeType===3&&!t.nodeValue}function yr(t){return t.nodeType===3&&Nt(t)===0}function Cr(t){return t.nodeType===1&&t.tagName==="BR"}function Nt(t){if(t.nodeType===3)return bt(t.nodeValue).length;let e=0;return Array.from(t.childNodes).reverse().every((r,n,o)=>yr(r)||Cr(r)?!0:(e=o.length-n,!1)),e}function J(t,e,r){if(e===t)return Tt(e,r);if(Tt(e,r)){let n=Ue(e);return J(t,e.parentNode,n)}return!1}function Ke(t,e,r){if(e===t)return vt(e,r);if(vt(e,r)){let n=Ue(e)+1;return Ke(t,e.parentNode,n)}return!1}function Tt(t,e){return t.nodeType===3?e===0:t.childNodes.length===0||t.childNodes.length===1&&t.firstChild.nodeType===1&&t.firstChild.getAttribute("data-editable")==="remove"?!0:t.childNodes[e]===t.firstChild}function vt(t,e){return t.nodeType===3?e===t.length:t.childNodes.length===0?!0:e>0?t.childNodes[e-1]===t.lastChild:!1}function Z(t,e,r){if(e===t)return St(e,r);if(St(e,r)){let n=Ue(e)+1;return Z(t,e.parentNode,n)}return!1}function St(t,e){if(t.nodeType===3){let r=bt(t.nodeValue);return e>=r.length}return t.childNodes.length===0?!0:e>=Nt(t)}function Et(t,e){let r,n,o;if(t.nodeType!==e.nodeType||t.nodeName!==e.nodeName)return!1;for(r=0,n=t.attributes.length;r<n;r++)if(o=t.attributes[r],e.getAttribute(o.name)!==o.value)return!1;return!0}function me(t){return t.lastChild?me(t.lastChild):t}function Fo(t){return console.warn("Editable.js: Using obsolete function parser.latestCild(), use lastChild() instead"),me(t)}function ze(t){return t&&t.nodeType===11&&t.childNodes.length===0}function Po(t,e){switch((e.currentStyle||t.getComputedStyle(e,"")).display){case"inline":case"inline-block":return!0;default:return!1}}var N={};ar(N,{adoptElement:()=>ee,areSameAttributes:()=>Mt,cleanInternals:()=>Bt,cloneRangeContents:()=>Ye,containsString:()=>rt,createFragmentFromString:()=>I,deleteCharacter:()=>te,expandTo:()=>Pt,extractContent:()=>Xe,forceWrap:()=>tt,getAncestorTags:()=>Je,getContainedTags:()=>It,getInnerHtmlOfFragment:()=>ye,getInnerTags:()=>Ze,getTagNames:()=>Ft,getTags:()=>F,getTagsByName:()=>_t,getTagsByNameAndAttributes:()=>Nr,insertCharacter:()=>kt,isAffectedBy:()=>Ko,isExactSelection:()=>et,isWrappable:()=>Ce,normalizeTags:()=>Ot,normalizeWhitespace:()=>Rt,nuke:()=>Ht,nukeElem:()=>Wt,nukeTag:()=>Qo,removeFormatting:()=>jt,removeFormattingElem:()=>Ar,selectNodeContents:()=>zo,surround:()=>$t,tidyHtml:()=>G,toggleTag:()=>Dt,unwrap:()=>w,unwrapInternalNodes:()=>Lt,wrap:()=>Er});var Do=0,jo="\uFEFF";function Tr(t,e){let r=t.commonAncestorContainer;return r.nodeType===3?!1:e.parentElement?.parentElement===r}function At(t,e){let r=t.commonAncestorContainer;r.ownerDocument||S("Cannot save range: range is empty");let n=r.ownerDocument.defaultView.document,o=n.createElement("span");o.id=`editable-range-boundary-${++Do}`,o.setAttribute("data-editable","remove"),o.style.lineHeight="0",o.style.display="none",o.appendChild(n.createTextNode(jo));let i=e&&Tr(t,t.startContainer),s=!e&&Tr(t,t.endContainer);if(i){let a=t.startContainer.parentElement;a.parentElement.insertBefore(o,a)}else if(s){let a=t.endContainer.parentElement;a.parentElement.insertBefore(o,a.nextSibling)}else{let a=t.cloneRange();a.collapse(e),a.insertNode(o)}return o}function vr(t,e,r,n){let o=Sr(t,r);if(!o)return console.log("Marker element has been removed. Cannot restore selection.");e[n?"setStartBefore":"setEndBefore"](o),o.remove()}function Ge(t){let e,r,n;return t.collapsed?(n=At(t,!1),e={markerId:n.id,collapsed:!0}):(n=At(t,!1),r=At(t,!0),e={startMarkerId:r.id,endMarkerId:n.id,collapsed:!1}),t.collapsed?(t.setStartBefore(n),t.collapse(!0)):(t.setEndBefore(n),t.setStartAfter(r)),e}function Qe(t,e){if(e.restored)return;let r=m();if(e.collapsed){let n=Sr(t,e.markerId);if(n){n.style.display="inline";let o=n.previousSibling;o&&o.nodeType===3?(n.remove(),r.setStart(o,o.length)):(r.setStartBefore(n),r.collapse(!0),n.remove())}else console.log("Marker element has been removed. Cannot restore selection.")}else vr(t,r,e.startMarkerId,!0),vr(t,r,e.endMarkerId,!1);return he(r),r}function Sr(t,e){return t.querySelector(`#${e}`)}function xe(t,e,r){return e=Ge(e),r(),Qe(t,e)}var Ho=/\u200B/g,Wo=/\uFEFF/g,$o=/[^\S ]/g,Vo=/^\s+$/,qo=/^\s+/,Uo=/\s+$/;function G(t){Ot(t)}function Ot(t){let e=document.createDocumentFragment();be(t,"firstChild"),be(t,"lastChild");for(let r of t.childNodes)if(!(r.nodeName!=="BR"&&!r.textContent)){if(r.nodeType===1&&r.nodeName!=="BR"){let n=r;for(;(n=n.nextSibling)!==null&&Et(n,r);){for(let o of n.childNodes)r.appendChild(o.cloneNode(!0));n.remove()}Ot(r)}e.appendChild(r.cloneNode(!0))}for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(e)}function Rt(t){return t.replace($o," ")}function Bt(t){t.innerHTML=Xe(t,!0)}function Xe(t,e){let r=(t.nodeType===11?ye(t):t.innerHTML).replace(Wo,"").replace(Ho,"<br>"),n=document.createElement("div");return n.innerHTML=r,Lt(n,e),be(n,"firstChild"),be(n,"lastChild"),n.innerHTML}function ye(t){let e=document.createElement("div");return e.appendChild(t),e.innerHTML}function I(t){let e=document.createElement("div");e.innerHTML=t;let r=document.createDocumentFragment();for(;e.firstChild;)r.appendChild(e.firstChild);return r}function ee(t,e){return t.ownerDocument!==e?e.adoptNode(t):t}function Ye(t){let r=t.cloneContents().childNodes[0],n=document.createDocumentFragment();for(;r.childNodes.length;)n.appendChild(r.childNodes[0]);return n}function be(t,e,r=!0){let n;for(;n=t[e];)if(n.nodeType===3)if(Vo.test(n.textContent))t.removeChild(n);else break;else if(n.nodeName==="BR")n.remove();else{n[e]&&be(n,e,!1);break}r&&(n=t[e],n?.nodeType===3&&l.trimLeadingAndTrailingWhitespaces&&(n.textContent=n.textContent.replace(e.startsWith("last")?Uo:qo,"")))}function Lt(t,e){for(;t;){let r=t.nextSibling;if(t.nodeType!==1){t=r;continue}let n=t.getAttribute("data-editable");t.firstChild&&Lt(t.firstChild,e),(n==="remove"||n==="ui-remove"&&!e)&&t.remove(),(n==="unwrap"||n==="ui-unwrap"&&!e)&&w(t),t=r}}function F(t,e,r){let n=Ze(e,r),o=Je(t,e,r);return n.concat(o)}function Je(t,e,r){let n=[],o=e.commonAncestorContainer;for(;o!==t;)(!r||r(o))&&n.push(o),o=o.parentNode;return n}function _t(t,e,r){return F(t,e,n=>n.nodeName.toUpperCase()===r.toUpperCase())}function Nr(t,e,r){return F(t,e,n=>n.nodeName.toUpperCase()===r.nodeName.toUpperCase()&&Mt(n.attributes,r.attributes))}function Mt(t,e){if(t.length!==e.length)return!1;for(let r=0;r<t.length;r++){let n=e[t[r].name];if(!(n&&n.value===t[r].value))return!1}return!0}function Ze(t,e){return $e(t,[1],e)}function It(t,e){return $e(t,[1],e).filter(r=>pr(t,r))}function Ft(t=[]){return t.map(e=>e.nodeName)}function Ko(t,e,r){return F(t,e).some(n=>n.nodeName===r.toUpperCase())}function zo(t){let e=m();return e.selectNodeContents(t),e}function Go(t,e){return t.compareBoundaryPoints(Range.END_TO_START,e)===-1&&e.compareBoundaryPoints(Range.END_TO_START,t)===-1}function et(t,e,r){let n=m();if(n.selectNodeContents(e),!Go(t,n))return!1;let o=t.toString(),i=(e.jquery?e[0]:e).textContent;return r&&(o=de(o),i=de(i)),o!==""&&o===i}function Pt(t,e,r){return e.selectNodeContents(r),e}function Dt(t,e,r){let n=Nr(t,e,r);return n.length===1&&et(e,n[0],"visible")?Ar(t,e,r):tt(t,e,r)}function Ce(t){return Jo(t)}function tt(t,e,r){let n=xe(t,e,()=>{Wt(t,e,r)});return Ce(n)||(n=xe(t,n,()=>{Ht(t,n)})),Er(n,r),n}function Er(t,e){if(!Ce(t)){console.log("content.wrap(): can not surround range");return}typeof e=="string"&&(e=He(e)),t.surroundContents(e)}function w(t){t=t.jquery?t[0]:t;let e=t.parentNode;for(;t.firstChild;)e.insertBefore(t.firstChild,t);e.removeChild(t)}function Ar(t,e,r){return xe(t,e,()=>{Wt(t,e,r)})}function jt(t,e,r){return xe(t,e,()=>{Ht(t,e,r)})}function Ht(t,e,r){F(t,e).forEach(n=>{n.nodeName.toUpperCase()!=="BR"&&(!r||n.matches(r))&&w(n)})}function Wt(t,e,r){F(t,e).forEach(n=>{n.nodeName.toUpperCase()!=="BR"&&(!r||n.nodeName.toUpperCase()===r.nodeName.toUpperCase()&&Mt(n.attributes,r.attributes))&&w(n)})}function kt(t,e,r){let n=document.createTextNode(e),o=t.cloneRange();o.collapse(r),o.insertNode(n),t[r?"setStartBefore":"setEndAfter"](n),he(t)}function $t(t,e,r,n){return kt(e,n||r,!1),kt(e,r,!0),e}function te(t,e,r){if(!rt(e,r))return e;window.getSelection().rangeCount>0&&mr(e);let n=xe(t,e,()=>{$e(e,[3],o=>o.nodeValue.indexOf(r)>=0).forEach(o=>{o.nodeValue=o.nodeValue.replaceAll(r,"")})});return he(n),n}function rt(t,e){return t.toString().indexOf(e)>=0}function Qo(t,e,r){F(t,e).forEach(n=>{n.nodeName.toUpperCase()===r.toUpperCase()&&w(n)})}function Xo(t,e){let r=t,n=null;function o(){if(!r)return null;if(r.firstChild&&n!==r.firstChild)n=r,r=r.firstChild;else if(r.nextSibling)n=r,r=r.nextSibling;else{let i=r.parentNode;for(;i&&i!==t;){if(i.nextSibling){n=r=i.nextSibling;break}i=i.parentNode}(!i||i===t)&&(n=r=null)}return r}return{next:o}}function Yo(t,e){let r=document.createRange();return r.selectNodeContents(t),e.compareBoundaryPoints(Range.START_TO_START,r)<=0&&e.compareBoundaryPoints(Range.END_TO_END,r)>=0}function Jo(t){if(!t||!t.startContainer||!t.endContainer)return!1;if(t.startContainer===t.endContainer)return!0;let e=Xo(t.commonAncestorContainer,function(o){return t.isPointInRange(o,0)}),r,n=!1;for(;r=e.next();)if(r.nodeType===Node.ELEMENT_NODE&&!Yo(r,t)){n=!0;break}return!n}var kr=1,Zo={},Vt=Br("nextElementSibling"),qt=Br("previousElementSibling");function Or(t,{normalize:e,plainText:r,shouldSpellcheck:n}){ei(t),t.setAttribute("contenteditable",!0),t.setAttribute("spellcheck",Boolean(n)),t.setAttribute("data-plaintext",Boolean(r)),t.classList.remove(l.editableDisabledClass),t.classList.add(l.editableClass),e&&G(t)}function Rr(t){t.removeAttribute("contenteditable"),t.removeAttribute("spellcheck"),t.removeAttribute("data-plaintext"),ti(t,void 0),t.classList.remove(l.editableClass),t.classList.add(l.editableDisabledClass)}function Te(t){return t.getAttribute("data-plaintext")==="true"}function ei(t){t.hasAttribute("data-editable")||(t.setAttribute("data-editable",`id-${kr}`),kr+=1)}function ti(t,e){if(t.hasAttribute("data-editable")){let r=t.getAttribute("data-editable");Zo[r]=e}}function Br(t){return function(e){let r=e[t];return r&&r.getAttribute("contenteditable")?r:null}}var ri=[["\xAB","\xBB"],["\xBB","\xAB"],['"','"'],["\u201C","\u201D"],["\u201D","\u201D"],["\u201C","\u201C"],["\u201E","\u201C"]],ni=[["\u2018","\u2019"],["\u2039","\u203A"],["\u201A","\u2018"],["\u2019","\u2019"],["\u203A","\u2039"],["'","'"],["\u2018","\u2019"]],oi=["\u2019","'"],_r=/([‘’‹›‚'«»"“”„])(?![^<]*?>)/g,ii=/\s|[>\-–—«»”"“„]/,si=/\s|[<\-–—«»”"“‘’‹›'.;?:,]/,E;function Mr(t,e){E=e||{},E.quotes=E.quotes||[void 0,void 0],E.singleQuotes=E.singleQuotes||[void 0,void 0];let r=li(t);return r.length>0?(Ir(r,0),ui(t,r)):t}function Ir(t,e){for(;e<t.length;){let r=ai(t,e);if(r){if(t[e].replace=r.type==="double"?E.quotes[0]:E.singleQuotes[0],t[r.position].replace=r.type==="double"?E.quotes[1]:E.singleQuotes[1],r.position!==e+1){let n=t.slice(e+1,r.position);n&&Ir(n,0)}e=r.position+1}else t[e].replace=ci(t[e].char),e+=1}}function ai(t,e){if(e===t.length-1)return;let r=t[e],n=r.char;if(r.before&&!ii.test(r.before))return;let o=Lr(n,ni),i=Lr(n,ri);for(let s=e+1;s<t.length;s++)if(t[s].after&&si.test(t[s].after)||!t[s].after){if(o.includes(t[s].char))return{position:s,type:"single"};if(i.includes(t[s].char))return{position:s,type:"double"}}}function Lr(t,e){return e.filter(r=>r[0]===t).map(r=>r[1])}function ci(t){if(oi.includes(t))return E.apostrophe}function li(t){return[...t.matchAll(_r)].map(e=>{let r=e.index;return{char:e[1],before:r>0?t[r-1]:"",after:r+1<t.length?t[r+1]:""}})}function ui(t,e){let r=0;return t.replace(_r,n=>{let o=e[r].replace||e[r].char;return r+=1,o})}var Qt,Fr,Pr,Dr,Kt,ve,zt,jr,Hr=/^\s*$/,Gt="<!-- BLOCK -->",Wr;Xt(l);function Xt(t){let e=t.pastedHtmlRules;Qt=e.allowedElements||{},Fr=e.allowedPlainTextElements||{},Pr=e.requiredAttributes||{},Dr=e.transformElements||{},jr=e.blacklistedElements||[],Wr=e.keepInternalRelativeLinks||!1,ve=e.replaceQuotes||{},Kt={},e.blockLevelElements.forEach(r=>{Kt[r]=!0}),zt={},e.splitIntoBlocks.forEach(r=>{zt[r]=!0})}function $r(t,e,r){let n=t.ownerDocument;t.setAttribute(l.pastingAttribute,!0),e.isSelection&&(e=e.deleteExactSurroundingTags().deleteContainedTags().deleteContent());let o=n.createElement("div");o.innerHTML=r;let i=Te(t),s=di(o,{plainText:i});return t.removeAttribute(l.pastingAttribute),{blocks:s,cursor:e}}function di(t,{plainText:e=!1}={}){return Vr(t,{allowedElements:e?Fr:Qt,keepInternalRelativeLinks:e?!1:Wr}).split(Gt).map(n=>de(bi(yi(n)))).filter(n=>!Hr.test(n))}function Vr(t,e){return Array.from(t.childNodes).reduce((r,n)=>{if(jr.indexOf(n.nodeName.toLowerCase())!==-1)return"";if(e.keepInternalRelativeLinks&&n.nodeName==="A"&&n.href){let o=n.getAttribute("href").replace(window.location.origin,"");n.setAttribute("href",o)}if(n.nodeType===1){let o=Vr(n,e);return r+hi(n,o,e)}return n.nodeType===3?r+cr(n.nodeValue):r},"")}function hi(t,e,r){let n=t.nodeName.toLowerCase();if(n=gi(n),xi(n,t,r)){let o=pi(n,t);return n==="br"?`<${n+o}>`:Hr.test(e)?e:`<${n+o}>${e}</${n}>`}return zt[n]?Gt+e+Gt:Kt[n]?`${e} `:e}function pi(t,e){return Array.from(e.attributes).reduce((r,{name:n,value:o})=>Qt[t]?.[n]&&o?`${r} ${n}="${o}"`:r,"")}function gi(t){return Dr[t]||t}function mi(t,e){let r=Pr[t];return r?!r.some(n=>!e.getAttribute(n)):!0}function xi(t,e,r){return r.allowedElements[t]&&mi(t,e)}function bi(t){return t.replace(/\n/g," ").replace(/ {2,}/g," ").replace(/(.)\u00A0/g,(e,r)=>r+(/[\u0020]/.test(r)?"\xA0":" "))}function yi(t){return ve.quotes||ve.singleQuotes||ve.apostrophe?Mr(t,ve):t}var fl=typeof document.documentElement.contentEditable<"u",Ci=/(apple)?webkit\/537\.36/i.test(window.navigator.userAgent),Ti=/(apple)?webkit/i.test(window.navigator.userAgent),vi=!Ci&&Ti,Si=t=>{let e=t,r=e.onselectionchange;if(r!==void 0)try{return e.onselectionchange=0,e.onselectionchange===null}catch{}finally{e.onselectionchange=r}return!1},Ur=Si(document),Kr=!!vi;function Se(t,e){let r=wi(e);t.on=r.on,t.off=r.off,t.notify=r.notify}function wi(t){let e={};function r(o,i){o.split(" ").forEach(s=>{e[s]=e[s]||[],e[s].unshift(i)})}function n(o,i){let s=e[o];if(!s)return;let a=s.indexOf(i);a<0||s.splice(a,1)}return{on(o,i){if(arguments.length===2)r(o,i);else if(arguments.length===1)for(let s in o)r(s,o[s]);return this},off(o,i){arguments.length===2?n(o,i):arguments.length===1?e[o]=[]:e={}},notify(o,i){let s=Array.from(arguments);if(t?(i=o,o=t,s.splice(0,1)):s.splice(0,2),this.switchContext){let c=this.switchContext.events.shift();i!==c&&(this.switchContext=void 0)}let a=e[i];a&&a.every(c=>c.apply(o,s)!==!1)}}}function Yt(t){let e=t.pageXOffset!==void 0?t.pageXOffset:(t.document.documentElement||t.document.body.parentNode||t.document.body).scrollLeft,r=t.pageYOffset!==void 0?t.pageYOffset:(t.document.documentElement||t.document.body.parentNode||t.document.body).scrollTop;return{x:e,y:r}}var p=class{static findHost(e,r){return Y(e,r)}constructor(e,r){this.setHost(e),this.range=r,this.isCursor=!0}getTags(e){return F(this.host,this.range,e)}getTagNames(e){return Ft(this.getTags(e))}getTagsByName(e){return _t(this.host,this.range,e)}getInnerTags(e){return Ze(this.range,e)}getContainedTags(e){return It(this.range,e)}getAncestorTags(e){return Je(this.host,this.range,e)}isAtEnd(){return Ke(this.host,this.range.endContainer,this.range.endOffset)}isAtTextEnd(){return Z(this.host,this.range.endContainer,this.range.endOffset)}isAtLastLine(){let e=this.win.document.createRange();e.selectNodeContents(this.host),e.collapse(!1);let r=nt(e,this.win),n=nt(this.range,this.win);return zr(r.bottom,n.bottom)}isAtFirstLine(){let e=this.win.document.createRange();e.selectNodeContents(this.host),e.collapse(!0);let r=nt(e,this.win),n=nt(this.range,this.win);return zr(r.top,n.top)}isAtBeginning(){return J(this.host,this.range.startContainer,this.range.startOffset)}insertBefore(e){if(yt(e)&&(e=I(e)),ze(e))return;e=this.adoptElement(e);let r=e;if(e.nodeType===11){let n=e.childNodes.length-1;r=e.childNodes[n]}this.range.insertNode(e),this.range.setStartAfter(r),this.range.setEndAfter(r),this.host.normalize()}insertAfter(e){if(yt(e)&&(e=I(e)),ze(e))return;e=this.adoptElement(e);let r=this.range.cloneRange();r.setStart(r.endContainer,r.endOffset),r.collapse(!0),r.insertNode(e),this.host.normalize()}setSelection(){this.setVisibleSelection()}setVisibleSelection(){if(this.win.document.activeElement!==this.host){let{x:r,y:n}=Yt(this.win);this.win.scrollTo(r,n)}let e=We(this.win);e.removeAllRanges(),e.addRange(this.range)}before(){let e=this.range.cloneRange();return e.collapse(!0),e.setStartBefore(this.host),Ye(e)}textBefore(){let e=this.range.cloneRange();return e.collapse(!0),e.setStartBefore(this.host),e.toString()}beforeHtml(){return ye(this.before())}after(){let e=this.range.cloneRange();return e.collapse(!1),e.setEndAfter(this.host),Ye(e)}textAfter(){let e=this.range.cloneRange();return e.collapse(!1),e.setEndAfter(this.host),e.toString()}afterHtml(){return ye(this.after())}getBoundingClientRect(){return this.range.getBoundingClientRect()}getCoordinates(e="absolute"){let r=this.range.getBoundingClientRect();if(e==="fixed")return r;let{x:n,y:o}=Yt(this.win);return{top:r.top+o,bottom:r.bottom+o,left:r.left+n,right:r.right+n,height:r.height,width:r.width}}moveBefore(e){if(this.updateHost(e),this.range.setStartBefore(e),this.range.setEndBefore(e),this.isSelection)return new p(this.host,this.range)}moveAfter(e){if(this.updateHost(e),this.range.setStartAfter(e),this.range.setEndAfter(e),this.isSelection)return new p(this.host,this.range)}moveAtBeginning(e=this.host){if(this.updateHost(e),this.range.selectNodeContents(e),this.range.collapse(!0),this.isSelection)return new p(this.host,this.range)}moveAtEnd(e=this.host){if(this.updateHost(e),this.range.selectNodeContents(e),this.range.collapse(!1),this.isSelection)return new p(this.host,this.range)}moveAtTextEnd(e){return this.moveAtEnd(me(e))}setHost(e){e.jquery&&(e=e[0]),this.host=e,this.win=e==null?window:e.ownerDocument.defaultView}updateHost(e){let r=ge(e);r||S("Can not set cursor outside of an editable block"),this.setHost(r)}retainVisibleSelection(e){this.save(),e(),this.restore(),this.setVisibleSelection()}save(){this.savedRangeInfo=Ge(this.range),this.savedRangeInfo.host=this.host}restore(){this.savedRangeInfo||S("Could not restore selection"),this.host=this.savedRangeInfo.host,this.range=Qe(this.host,this.savedRangeInfo),this.savedRangeInfo=void 0}equals(e){return!(!e||!e.host||!e.host.isEqualNode(this.host)||!e.range||!qe(e.range,this.range))}createElement(e,r={}){let n=this.win.document.createElement(e);for(let o in r){let i=r[o];n.setAttribute(o,i)}return n}createTextNode(e){return this.win.document.createTextNode(e)}adoptElement(e){return ee(e,this.win.document)}triggerChange(){let e=new Event("formatEditable",{bubbles:!0,cancelable:!1});this.host.dispatchEvent(e)}};function nt(t,e){if(t.startContainer.nodeType!==1)return t.getBoundingClientRect();let r=e.document.createElement("span");r.setAttribute("doc-editable","unwrap"),t.insertNode(r);let n=r.getBoundingClientRect();return r.remove(),n}function zr(t,e){return t===e||Math.abs(t-e)<=2}var v={extractText(t,e=!0){let r="";return Ei(t,e,n=>{r+=n}),r},highlightMatches(t,e,r=!0){if(!e||e.length===0)return;t.normalize();let n=new T(t),o=0,i=0,s=e[o],a=[],c,u,d;for(;c=n.getNext();){if(c.nodeType===3&&c.data!=="")d=c;else if(r&&c.nodeType===1&&c.nodeName==="BR"){i+=1;continue}else continue;let b=d.data,B=i+b.length;if(s.startIndex<B&&i<s.endIndex){let D=i<=s.startIndex,L=B>=s.endIndex;D&&(u=s.id||s.startIndex);let j;D?j=s.startIndex-i:j=0;let _;L?_=s.endIndex-i-j:_=b.length-j;let xt={element:d,text:b.substring(j,j+_),offset:j,length:_,isLastPortion:L,wordId:u};if(a.push(xt),L){let Lo=this.wrapMatch(a,s.marker,s.title);n.replaceCurrent(Lo),B=i+xt.length+xt.offset,a=[],o+=1,o<e.length&&(s=e[o])}}i=B}},wrapMatch(t,e,r){return t.map(n=>this.wrapPortion(n,e,r)).pop()},wrapPortion(t,e,r){let n=m();n.setStart(t.element,t.offset),n.setEnd(t.element,t.offset+t.length);let o=e.cloneNode(!0);if(o.setAttribute("data-word-id",t.wordId),r&&o.setAttribute("title",r),n.surroundContents(o),o.nextSibling){let i=o.nextSibling;i.nodeType===3&&i.data===""&&i.remove()}return o}};function Ei(t,e,r){let n=new T(t),o;for(;o=n.getNext();)o.nodeType===3&&o.data!==""?r(o.data):e&&o.nodeType===1&&o.nodeName==="BR"&&r(`
`)}function Qr(t,e,r){return Yr(t,[e],"text",r)}function Xr(t,e,r){return Yr(t,e,"word",r)}function Yr(t,e,r,n){if(!t||t==="")return[];if(n&&!Ai(n))return[];if(!e?.length)return[];let i=(r==="word"?Oi:ki)(e);return[...t.matchAll(i)].map(a=>{let c,u;return r==="word"?(c=a.index+a[1].length,u=a[2]):(c=a.index,u=a[0]),{startIndex:c,endIndex:c+u.length,match:u,marker:n}})}function Ai(t){try{return t?t instanceof t.ownerDocument?.defaultView.HTMLElement:!1}catch{return typeof t=="object"&&t.nodeType===1&&typeof t.style=="object"&&typeof t.ownerDocument=="object"}}function ki(t=[]){let r=`(${t.map(n=>Jr(n)).join("|")})`;return new RegExp(r,"g")}var Gr="\\u0041-\\u005A\\u0061-\\u007A\\u0030-\\u0039\\u00AA\\u00B5\\u00BA\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u00FF\\u0100-\\u017F\\u0180-\\u024F";function Oi(t=[]){let e=t.map(n=>Jr(n)),r=`([^${Gr}]|^)(${e.join("|")})(?=[^${Gr}]|$)`;return new RegExp(r,"g")}function Jr(t){return String(t).replace(/([.*+?^=!:${}()|[\]/\\])/g,"\\$1")}var Jt={highlightText(t,e,r,n,o){if(this.hasHighlight(t,r))return;let i=v.extractText(t),s=`<span class="highlight-${n}"></span>`,a=Jt.createMarkerNode(s,n,this.win),c=Qr(i,e,a);if(c&&c.length)return r&&(c[0].id=r),v.highlightMatches(t,c),o&&o.notify("change",t),c[0].startIndex},highlightRange(t,e,r,n,o,i,s="comment"){if(this.hasHighlight(t,r)&&this.removeHighlight(t,r),v.extractText(t,!1)==="")return-1;let c=Jt.createMarkerNode(`<span class="highlight-${s}"></span>`,s,this.win),u=n,d=o;return v.highlightMatches(t,[{startIndex:u,endIndex:d,id:r,marker:c}],!1),i&&i.notify("change",t),u},updateHighlight(t,e,r,n){if(!document.documentElement.classList)return;let o=t.querySelectorAll(`[data-word-id="${e}"]`);for(let i of o)n&&i.classList.remove(n),r&&i.classList.add(r)},removeHighlight(t,e,r){let n=t.querySelectorAll(`[data-word-id="${e}"]`);for(let o of n)w(o);t.normalize(),r&&r.notify("change",t)},hasHighlight(t,e){return!!t.querySelectorAll(`[data-word-id="${e}"]`).length},extractHighlightedRanges(t,e){let r="[data-word-id]";e&&(r+=`[data-highlight="${e}"]`);let n=t.querySelectorAll(r);if(!n.length)return;let o={};for(let s of n){let a=s.getAttribute("data-word-id");o[a]||(o[a]=t.querySelectorAll(`[data-word-id="${a}"]`))}let i={};for(let s in o){let a=this.extractMarkerNodePosition(t,o[s]);a&&(i[s]=a)}return i},extractMarkerNodePosition(t,e){let r=m();e.length>1?(r.setStartBefore(e[0]),r.setEndAfter(e[e.length-1])):r.selectNode(e[0]);let n=Ve(r,t);return{start:n.start,end:n.end,text:n.text,nativeRange:r}},cleanupStaleMarkerNodes(t,e){let r=t.querySelectorAll(`span[data-highlight="${e}"]`);for(let n of r)n.textContent.length||n.remove()},createMarkerNode(t,e,r){let n=He(t,r);return n.setAttribute("data-editable","ui-unwrap"),n.setAttribute("data-highlight",e),n}},y=Jt;var A=class extends p{constructor(){super(...arguments),delete this.isCursor,this.isSelection=!0}text(){return this.range.toString()}html(){return xr(this.range)}isAllSelected(){return J(this.host,this.range.startContainer,this.range.startOffset)&&Z(this.host,this.range.endContainer,this.range.endOffset)}getTextRange(){return Ve(this.range,this.host)}toString(){return this.range.toString()}isWrappable(){return Ce(this.range)}getRects(){return this.range.getClientRects()}link(e,r={}){e&&(r.href=e);let n=this.createElement(l.linkMarkup.name,l.linkMarkup.attribs);for(let o in r){let i=r[o];i!==void 0&&(i===null?n.removeAttribute(o):n.setAttribute(o,i))}l.linkMarkup.trim&&this.trimRange(),this.forceWrap(n)}trimRange(){let e=this.range.toString(),r=e.search(/\S|$/),n=e.search(/\S[\s]+$/),o=n===-1?0:e.length-(n+1),[i,s]=De({root:this.range.commonAncestorContainer,startContainer:this.range.startContainer,startOffset:this.range.startOffset,whitespacesOnTheLeft:r});this.range.setStart(i,s);let[a,c]=je({root:this.range.commonAncestorContainer,endContainer:this.range.endContainer,endOffset:this.range.endOffset,whitespacesOnTheRight:o});this.range.setEnd(a,c)}unlink(){this.removeFormatting(l.linkMarkup.name)}toggleLink(e,r){let n=this.getTagsByName(l.linkMarkup.name);if(n.length>=1){let o=n[0];this.isExactSelection(o,"visible")?this.unlink():this.expandTo(o)}else this.link(e,r)}highlightComment({highlightId:e,textRange:r}){y.highlightRange(this.host,e,r.text,r.start,r.end,void 0,"comment")}highlight({highlightId:e}){let r=this.textBefore(),n=this.text(),o='<span class="highlight-comment"></span>',i=y.createMarkerNode(o,this.win);i.setAttribute("data-match",n);let s={startIndex:r.length,endIndex:r.length+n.length,match:n,marker:i};v.highlightMatches(this.host,[s])}toggle(e){Te(this.host)||this.range.collapsed||(e=this.adoptElement(e),this.range=Dt(this.host,this.range,e),this.setVisibleSelection())}toggleCustom({tagName:e,attributes:r,trim:n=!1}){let o=this.createElement(e,r);n&&this.trimRange(),this.toggle(o)}makeCustom({tagName:e,attributes:r,trim:n=!1}){let o=this.createElement(e,r);n&&this.trimRange(),this.forceWrap(o)}makeBold(){let e=this.createElement(l.boldMarkup.name,l.boldMarkup.attribs);l.boldMarkup.trim&&this.trimRange(),this.forceWrap(e)}toggleBold(){let e=this.createElement(l.boldMarkup.name,l.boldMarkup.attribs);l.boldMarkup.trim&&this.trimRange(),this.toggle(e)}giveEmphasis(){let e=this.createElement(l.italicMarkup.name,l.italicMarkup.attribs);l.italicMarkup.trim&&this.trimRange(),this.forceWrap(e)}toggleEmphasis(){let e=this.createElement(l.italicMarkup.name,l.italicMarkup.attribs);l.italicMarkup.trim&&this.trimRange(),this.toggle(e)}makeUnderline(){let e=this.createElement(l.underlineMarkup.name,l.underlineMarkup.attribs);l.underlineMarkup.trim&&this.trimRange(),this.forceWrap(e)}toggleUnderline(){let e=this.createElement(l.underlineMarkup.name,l.underlineMarkup.attribs);l.underlineMarkup.trim&&this.trimRange(),this.toggle(e)}insertCharacter(e){let r=this.deleteContent(),n=r.createTextNode(e);return r.insertBefore(n),r.setVisibleSelection(),r}surround(e,r){this.range=$t(this.host,this.range,e,r),this.setVisibleSelection()}removeSurround(e,r){this.range=te(this.host,this.range,e),this.range=te(this.host,this.range,r),this.setVisibleSelection()}removeChars(e=[]){for(let r=0;r<e.length;r++){let n=e[r];this.range=te(this.host,this.range,n)}this.setVisibleSelection()}toggleSurround(e,r){this.containsString(e)&&this.containsString(r)?this.removeSurround(e,r):this.surround(e,r)}removeFormatting(e){this.range=jt(this.host,this.range,e),this.setVisibleSelection()}deleteExactSurroundingTags(){let e=this.getAncestorTags().reverse();for(let r of e)if(this.isExactSelection(r)){r.remove();break}return new A(this.host,this.range)}deleteContainedTags(){return this.getContainedTags().forEach(r=>r.remove()),new A(this.host,this.range)}deleteContent(){return this.range.deleteContents(),new p(this.host,this.range)}expandTo(e){this.range=Pt(this.host,this.range,e),this.setVisibleSelection()}collapseAtBeginning(e){return this.range.collapse(!0),this.setVisibleSelection(),new p(this.host,this.range)}collapseAtEnd(e){return this.range.collapse(!1),this.setVisibleSelection(),new p(this.host,this.range)}forceWrap(e){Te(this.host)||this.range.collapsed||(e=this.adoptElement(e),this.range=tt(this.host,this.range,e),this.setVisibleSelection())}isExactSelection(e,r){return et(this.range,e,r)}containsString(e){return rt(this.range,e)}deleteCharacter(e){this.range=te(this.host,this.range,e),this.setVisibleSelection()}};var $=class{constructor(e,r){this.host=e&&e.jquery?e[0]:e,this.range=r?.cloneRange(),this.isAnythingSelected=r!==void 0,this.isCursor=this.isAnythingSelected&&r.collapsed,this.isSelection=this.isAnythingSelected&&!this.isCursor}getCursor(){if(this.isCursor)return new p(this.host,this.range)}getSelection(){if(this.isSelection)return new A(this.host,this.range)}forceCursor(){return this.isSelection?this.getSelection().deleteContent():this.getCursor()}isDifferentFrom(e=new $){let r=this.range,n=e.range;return r&&n?!qe(r,n):!(!r&&!n)}};var we=class{constructor(e,r){this.dispatcher=e,this.win=r||window,this.selection=void 0,this.currentSelection=void 0,this.currentRange=void 0}syncSelection(){try{this.selection=We(this.win)}catch{return!1}return!0}getRangeContainer(){let e=this.syncSelection();if(this.selection?.rangeCount&&e){let r=this.selection.getRangeAt(0),n=ge(r.commonAncestorContainer);if(n)return new $(n,r)}return new $}getFreshRange(){return this.getRangeContainer()}getFreshSelection(){let e=this.getRangeContainer();return e.isCursor?e.getCursor(this.win):e.getSelection(this.win)}getSelection(){return this.currentSelection}forceCursor(){return this.getRangeContainer().forceCursor()}selectionChanged(){let e=this.getRangeContainer();if(e.isDifferentFrom(this.currentRange)){let r=this.currentSelection;this.currentRange=e,r&&(r.isCursor&&!this.currentRange.isCursor?this.dispatcher.notify("cursor",r.host):r.isSelection&&!this.currentRange.isSelection&&this.dispatcher.notify("selection",r.host)),this.currentRange.isCursor?(this.currentSelection=new p(this.currentRange.host,this.currentRange.range),this.dispatcher.notify("cursor",this.currentSelection.host,this.currentSelection)):this.currentRange.isSelection?(this.currentSelection=new A(this.currentRange.host,this.currentRange.range),this.dispatcher.notify("selection",this.currentSelection.host,this.currentSelection)):this.currentSelection=void 0}}};var k=class{constructor(e){Se(this),this.selectionWatcher=e}dispatchKeyEvent(e,r,n){switch(e.keyCode){case this.key.left:return this.notify(r,"left",e);case this.key.right:return this.notify(r,"right",e);case this.key.up:return this.notify(r,"up",e);case this.key.down:return this.notify(r,"down",e);case this.key.tab:return e.shiftKey?this.notify(r,"shiftTab",e):this.notify(r,"tab",e);case this.key.esc:return this.notify(r,"esc",e);case this.key.backspace:return this.preventContenteditableBug(r,e),this.notify(r,"backspace",e);case this.key.delete:return this.preventContenteditableBug(r,e),this.notify(r,"delete",e);case this.key.enter:return e.shiftKey?this.notify(r,"shiftEnter",e):this.notify(r,"enter",e);case this.key.ctrl:case this.key.shift:case this.key.alt:return;case 224:case 17:case 91:case 93:return;default:if(e.keyCode===this.key.b&&(e.ctrlKey||e.metaKey))return this.notify(r,"bold",e);if(e.keyCode===this.key.i&&(e.ctrlKey||e.metaKey))return this.notify(r,"italic",e);if(this.preventContenteditableBug(r,e),!n)return;if(!e.ctrlKey&&!e.metaKey)return this.notify(r,"character",e)}}preventContenteditableBug(e,r){if(!Kr||r.ctrlKey||r.metaKey)return;let n=this.selectionWatcher.getFreshRange();if(!n.isSelection)return;let o=k.getNodeToRemove(n.range,e);o&&o.remove()}static getNodeToRemove(e,r){if(e.startOffset!==0)return;let n=e.startContainer;if(n.nodeType===3&&(n=n.parentNode),n===r)return;let o=m();if(o.setStartBefore(n.firstChild),o.setEndAfter(n.lastChild),hr(o,e))return;if(e.startContainer.nodeType===3){let s=[3,1],a=n.firstChild;do if(s.indexOf(a.nodeType)!==-1)break;while(a=a.nextSibling);if(a!==e.startContainer)return}let i=e.cloneRange();return i.setStartBefore(n),k.getNodeToRemove(i,r)||n}};k.key=k.prototype.key={left:37,up:38,right:39,down:40,tab:9,esc:27,backspace:8,delete:46,enter:13,shift:16,ctrl:17,alt:18,b:66,i:73};var Ne=class{constructor(e){let r=e.win;Se(this,e),this.document=r.document,this.config=e.config,this.editable=e,this.editableSelector=e.editableSelector,this.selectionWatcher=new we(this,r),this.keyboard=new k(this.selectionWatcher),this.activeListeners=[],this.setup(),this.getEditableBlockByEvent=n=>Y(n.target,e.editableSelector)}setupDocumentListener(e,r,n=!1){let o={event:e,listener:r.bind(this),capture:n};return this.activeListeners.push(o),this.document.addEventListener(e,o.listener,n),this}setup(){this.setupKeyboardEvents(),this.setupEventListeners()}unload(){this.off();for(let e of this.activeListeners)this.document.removeEventListener(e.event,e.listener,e.capture);this.activeListeners.length=0}suspend(){if(!this.suspended){this.suspended=!0;for(let e of this.activeListeners)this.document.removeEventListener(e.event,e.listener,e.capture);this.activeListeners.length=0}}continue(){this.suspended&&(this.suspended=!1,this.setupEventListeners())}setupEventListeners(){this.setupElementListeners(),this.setupKeydownListener(),Ur?this.setupSelectionChangeListeners():this.setupSelectionChangeFallbackListeners()}setupElementListeners(){this.setupDocumentListener("focus",function(r){let n=this.getEditableBlockByEvent(r);n&&(r.target.getAttribute(l.pastingAttribute)||(this.selectionWatcher.syncSelection(),this.notify("focus",n)))},!0).setupDocumentListener("blur",function(r){let n=this.getEditableBlockByEvent(r);n&&(n.getAttribute(l.pastingAttribute)||this.notify("blur",n))},!0).setupDocumentListener("copy",function(r){let n=this.getEditableBlockByEvent(r);if(!n)return;let o=this.selectionWatcher.getFreshSelection();o&&o.isSelection&&this.notify("clipboard",n,"copy",o)}).setupDocumentListener("cut",function(r){let n=this.getEditableBlockByEvent(r);if(!n)return;let o=this.selectionWatcher.getFreshSelection();o&&o.isSelection&&this.notify("clipboard",n,"cut",o)}).setupDocumentListener("paste",function(r){let n=this.getEditableBlockByEvent(r);if(!n)return;r.preventDefault();let o=this.selectionWatcher.getFreshSelection(),i=r.clipboardData.getData("text/html")||r.clipboardData.getData("text/plain"),{blocks:s,cursor:a}=$r(n,o,i);s.length?(ur(r.target.innerText)&&a.retainVisibleSelection(()=>{n.innerHTML=lr(n.innerHTML,"&nbsp;"," ")}),this.notify("paste",n,s,a),this.notify("change",n)):a.setVisibleSelection()}).setupDocumentListener("input",function(r){let n=this.getEditableBlockByEvent(r);n&&this.notify("change",n)}).setupDocumentListener("formatEditable",function(r){let n=this.getEditableBlockByEvent(r);n&&this.notify("change",n)})}dispatchSwitchEvent(e,r,n){if(e.altKey||e.ctrlKey||e.metaKey||e.shiftKey)return;let o=this.selectionWatcher.getFreshSelection();!o||o.isSelection||(this.switchContext?this.switchContext.events=["cursor"]:this.switchContext={positionX:o.getBoundingClientRect().left,events:["cursor"]},n==="up"&&o.isAtFirstLine()&&(e.preventDefault(),e.stopPropagation(),this.switchContext.events=["switch","blur","focus","cursor"],this.notify("switch",r,n,o)),n==="down"&&o.isAtLastLine()&&(e.preventDefault(),e.stopPropagation(),this.switchContext.events=["switch","blur","focus","cursor"],this.notify("switch",r,n,o)))}setupKeydownListener(){this.setupDocumentListener("keydown",function(e){let r=this.getEditableBlockByEvent(e);r&&this.keyboard.dispatchKeyEvent(e,r,!1)},!0)}setupKeyboardEvents(){let e=this;this.keyboard.on("up",function(r){e.dispatchSwitchEvent(r,this,"up")}).on("down",function(r){e.dispatchSwitchEvent(r,this,"down")}).on("backspace",function(r){let n=e.selectionWatcher.getFreshRange();if(!n.isCursor)return;let o=n.getCursor();o.isAtBeginning()&&(r.preventDefault(),r.stopPropagation(),e.notify("merge",this,"before",o))}).on("delete",function(r){let n=e.selectionWatcher.getFreshRange();if(!n.isCursor)return;let o=n.getCursor();o.isAtTextEnd()&&(r.preventDefault(),r.stopPropagation(),e.notify("merge",this,"after",o))}).on("enter",function(r){r.preventDefault(),r.stopPropagation();let o=e.selectionWatcher.getFreshRange().forceCursor();o.isAtTextEnd()?e.notify("insert",this,"after",o):o.isAtBeginning()?e.notify("insert",this,"before",o):e.notify("split",this,o.before(),o.after(),o)}).on("shiftEnter",function(r){r.preventDefault(),r.stopPropagation();let n=e.selectionWatcher.forceCursor();e.notify("newline",this,n)}).on("bold",function(r){r.preventDefault(),r.stopPropagation();let n=e.selectionWatcher.getFreshSelection();n.isSelection&&e.notify("toggleBold",n)}).on("italic",function(r){r.preventDefault(),r.stopPropagation();let n=e.selectionWatcher.getFreshSelection();n.isSelection&&e.notify("toggleEmphasis",n)}).on("character",function(r){e.notify("change",this)})}setupSelectionChangeListeners(){let e=!1,r=!1,n=this.selectionWatcher;this.setupDocumentListener("selectionchange",o=>{let i=this.selectionWatcher.getFreshSelection();i&&i.isSelection&&i.isAtBeginning()&&i.isAtEnd()?this.notify("selectToBoundary",i.host,o,"both"):i&&i.isSelection&&i.isAtBeginning()?this.notify("selectToBoundary",i.host,o,"start"):i&&i.isSelection&&i.isAtEnd()&&this.notify("selectToBoundary",i.host,o,"end"),r?e=!0:n.selectionChanged()}),this.setupDocumentListener("mousedown",function(o){this.getEditableBlockByEvent(o)&&(this.config.mouseMoveSelectionChanges===!1&&(r=!0,setTimeout(()=>n.selectionChanged(),0)),this.document.addEventListener("mouseup",()=>{r=!1,e&&(e=!1,n.selectionChanged())},{capture:!0,once:!0}))})}setupSelectionChangeFallbackListeners(){this.setupDocumentListener("mouseup",()=>{setTimeout(()=>this.selectionWatcher.selectionChanged(),0)}),this.setupDocumentListener("keyup",e=>{this.getEditableBlockByEvent(e)&&this.selectionWatcher.selectionChanged()})}};function Ri(){this.__data__=[],this.size=0}var Zr=Ri;function Bi(t,e){return t===e||t!==t&&e!==e}var V=Bi;function Li(t,e){for(var r=t.length;r--;)if(V(t[r][0],e))return r;return-1}var q=Li;var _i=Array.prototype,Mi=_i.splice;function Ii(t){var e=this.__data__,r=q(e,t);if(r<0)return!1;var n=e.length-1;return r==n?e.pop():Mi.call(e,r,1),--this.size,!0}var en=Ii;function Fi(t){var e=this.__data__,r=q(e,t);return r<0?void 0:e[r][1]}var tn=Fi;function Pi(t){return q(this.__data__,t)>-1}var rn=Pi;function Di(t,e){var r=this.__data__,n=q(r,t);return n<0?(++this.size,r.push([t,e])):r[n][1]=e,this}var nn=Di;function re(t){var e=-1,r=t==null?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}re.prototype.clear=Zr;re.prototype.delete=en;re.prototype.get=tn;re.prototype.has=rn;re.prototype.set=nn;var U=re;function ji(){this.__data__=new U,this.size=0}var on=ji;function Hi(t){var e=this.__data__,r=e.delete(t);return this.size=e.size,r}var sn=Hi;function Wi(t){return this.__data__.get(t)}var an=Wi;function $i(t){return this.__data__.has(t)}var cn=$i;var Vi=typeof global=="object"&&global&&global.Object===Object&&global,ot=Vi;var qi=typeof self=="object"&&self&&self.Object===Object&&self,Ui=ot||qi||Function("return this")(),C=Ui;var Ki=C.Symbol,ne=Ki;var ln=Object.prototype,zi=ln.hasOwnProperty,Gi=ln.toString,Ee=ne?ne.toStringTag:void 0;function Qi(t){var e=zi.call(t,Ee),r=t[Ee];try{t[Ee]=void 0;var n=!0}catch{}var o=Gi.call(t);return n&&(e?t[Ee]=r:delete t[Ee]),o}var un=Qi;var Xi=Object.prototype,Yi=Xi.toString;function Ji(t){return Yi.call(t)}var fn=Ji;var Zi="[object Null]",es="[object Undefined]",dn=ne?ne.toStringTag:void 0;function ts(t){return t==null?t===void 0?es:Zi:dn&&dn in Object(t)?un(t):fn(t)}var K=ts;function rs(t){var e=typeof t;return t!=null&&(e=="object"||e=="function")}var x=rs;var ns="[object AsyncFunction]",os="[object Function]",is="[object GeneratorFunction]",ss="[object Proxy]";function as(t){if(!x(t))return!1;var e=K(t);return e==os||e==is||e==ns||e==ss}var oe=as;var cs=C["__core-js_shared__"],it=cs;var hn=function(){var t=/[^.]+$/.exec(it&&it.keys&&it.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}();function ls(t){return!!hn&&hn in t}var pn=ls;var us=Function.prototype,fs=us.toString;function ds(t){if(t!=null){try{return fs.call(t)}catch{}try{return t+""}catch{}}return""}var gn=ds;var hs=/[\\^$.*+?()[\]{}|]/g,ps=/^\[object .+?Constructor\]$/,gs=Function.prototype,ms=Object.prototype,xs=gs.toString,bs=ms.hasOwnProperty,ys=RegExp("^"+xs.call(bs).replace(hs,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function Cs(t){if(!x(t)||pn(t))return!1;var e=oe(t)?ys:ps;return e.test(gn(t))}var mn=Cs;function Ts(t,e){return t?.[e]}var xn=Ts;function vs(t,e){var r=xn(t,e);return mn(r)?r:void 0}var ie=vs;var Ss=ie(C,"Map"),st=Ss;var ws=ie(Object,"create"),P=ws;function Ns(){this.__data__=P?P(null):{},this.size=0}var bn=Ns;function Es(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e}var yn=Es;var As="__lodash_hash_undefined__",ks=Object.prototype,Os=ks.hasOwnProperty;function Rs(t){var e=this.__data__;if(P){var r=e[t];return r===As?void 0:r}return Os.call(e,t)?e[t]:void 0}var Cn=Rs;var Bs=Object.prototype,Ls=Bs.hasOwnProperty;function _s(t){var e=this.__data__;return P?e[t]!==void 0:Ls.call(e,t)}var Tn=_s;var Ms="__lodash_hash_undefined__";function Is(t,e){var r=this.__data__;return this.size+=this.has(t)?0:1,r[t]=P&&e===void 0?Ms:e,this}var vn=Is;function se(t){var e=-1,r=t==null?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}se.prototype.clear=bn;se.prototype.delete=yn;se.prototype.get=Cn;se.prototype.has=Tn;se.prototype.set=vn;var Zt=se;function Fs(){this.size=0,this.__data__={hash:new Zt,map:new(st||U),string:new Zt}}var Sn=Fs;function Ps(t){var e=typeof t;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?t!=="__proto__":t===null}var wn=Ps;function Ds(t,e){var r=t.__data__;return wn(e)?r[typeof e=="string"?"string":"hash"]:r.map}var z=Ds;function js(t){var e=z(this,t).delete(t);return this.size-=e?1:0,e}var Nn=js;function Hs(t){return z(this,t).get(t)}var En=Hs;function Ws(t){return z(this,t).has(t)}var An=Ws;function $s(t,e){var r=z(this,t),n=r.size;return r.set(t,e),this.size+=r.size==n?0:1,this}var kn=$s;function ae(t){var e=-1,r=t==null?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}ae.prototype.clear=Sn;ae.prototype.delete=Nn;ae.prototype.get=En;ae.prototype.has=An;ae.prototype.set=kn;var On=ae;var Vs=200;function qs(t,e){var r=this.__data__;if(r instanceof U){var n=r.__data__;if(!st||n.length<Vs-1)return n.push([t,e]),this.size=++r.size,this;r=this.__data__=new On(n)}return r.set(t,e),this.size=r.size,this}var Rn=qs;function ce(t){var e=this.__data__=new U(t);this.size=e.size}ce.prototype.clear=on;ce.prototype.delete=sn;ce.prototype.get=an;ce.prototype.has=cn;ce.prototype.set=Rn;var Bn=ce;var Us=function(){try{var t=ie(Object,"defineProperty");return t({},"",{}),t}catch{}}(),le=Us;function Ks(t,e,r){e=="__proto__"&&le?le(t,e,{configurable:!0,enumerable:!0,value:r,writable:!0}):t[e]=r}var ue=Ks;function zs(t,e,r){(r!==void 0&&!V(t[e],r)||r===void 0&&!(e in t))&&ue(t,e,r)}var Ae=zs;function Gs(t){return function(e,r,n){for(var o=-1,i=Object(e),s=n(e),a=s.length;a--;){var c=s[t?a:++o];if(r(i[c],c,i)===!1)break}return e}}var Ln=Gs;var Qs=Ln(),_n=Qs;var Pn=typeof exports=="object"&&exports&&!exports.nodeType&&exports,Mn=Pn&&typeof module=="object"&&module&&!module.nodeType&&module,Xs=Mn&&Mn.exports===Pn,In=Xs?C.Buffer:void 0,Fn=In?In.allocUnsafe:void 0;function Ys(t,e){if(e)return t.slice();var r=t.length,n=Fn?Fn(r):new t.constructor(r);return t.copy(n),n}var Dn=Ys;var Js=C.Uint8Array,er=Js;function Zs(t){var e=new t.constructor(t.byteLength);return new er(e).set(new er(t)),e}var jn=Zs;function ea(t,e){var r=e?jn(t.buffer):t.buffer;return new t.constructor(r,t.byteOffset,t.length)}var Hn=ea;function ta(t,e){var r=-1,n=t.length;for(e||(e=Array(n));++r<n;)e[r]=t[r];return e}var Wn=ta;var $n=Object.create,ra=function(){function t(){}return function(e){if(!x(e))return{};if($n)return $n(e);t.prototype=e;var r=new t;return t.prototype=void 0,r}}(),Vn=ra;function na(t,e){return function(r){return t(e(r))}}var qn=na;var oa=qn(Object.getPrototypeOf,Object),at=oa;var ia=Object.prototype;function sa(t){var e=t&&t.constructor,r=typeof e=="function"&&e.prototype||ia;return t===r}var ct=sa;function aa(t){return typeof t.constructor=="function"&&!ct(t)?Vn(at(t)):{}}var Un=aa;function ca(t){return t!=null&&typeof t=="object"}var O=ca;var la="[object Arguments]";function ua(t){return O(t)&&K(t)==la}var tr=ua;var Kn=Object.prototype,fa=Kn.hasOwnProperty,da=Kn.propertyIsEnumerable,ha=tr(function(){return arguments}())?tr:function(t){return O(t)&&fa.call(t,"callee")&&!da.call(t,"callee")},ke=ha;var pa=Array.isArray,Oe=pa;var ga=9007199254740991;function ma(t){return typeof t=="number"&&t>-1&&t%1==0&&t<=ga}var lt=ma;function xa(t){return t!=null&&lt(t.length)&&!oe(t)}var fe=xa;function ba(t){return O(t)&&fe(t)}var zn=ba;function ya(){return!1}var Gn=ya;var Yn=typeof exports=="object"&&exports&&!exports.nodeType&&exports,Qn=Yn&&typeof module=="object"&&module&&!module.nodeType&&module,Ca=Qn&&Qn.exports===Yn,Xn=Ca?C.Buffer:void 0,Ta=Xn?Xn.isBuffer:void 0,va=Ta||Gn,ut=va;var Sa="[object Object]",wa=Function.prototype,Na=Object.prototype,Jn=wa.toString,Ea=Na.hasOwnProperty,Aa=Jn.call(Object);function ka(t){if(!O(t)||K(t)!=Sa)return!1;var e=at(t);if(e===null)return!0;var r=Ea.call(e,"constructor")&&e.constructor;return typeof r=="function"&&r instanceof r&&Jn.call(r)==Aa}var Zn=ka;var Oa="[object Arguments]",Ra="[object Array]",Ba="[object Boolean]",La="[object Date]",_a="[object Error]",Ma="[object Function]",Ia="[object Map]",Fa="[object Number]",Pa="[object Object]",Da="[object RegExp]",ja="[object Set]",Ha="[object String]",Wa="[object WeakMap]",$a="[object ArrayBuffer]",Va="[object DataView]",qa="[object Float32Array]",Ua="[object Float64Array]",Ka="[object Int8Array]",za="[object Int16Array]",Ga="[object Int32Array]",Qa="[object Uint8Array]",Xa="[object Uint8ClampedArray]",Ya="[object Uint16Array]",Ja="[object Uint32Array]",h={};h[qa]=h[Ua]=h[Ka]=h[za]=h[Ga]=h[Qa]=h[Xa]=h[Ya]=h[Ja]=!0;h[Oa]=h[Ra]=h[$a]=h[Ba]=h[Va]=h[La]=h[_a]=h[Ma]=h[Ia]=h[Fa]=h[Pa]=h[Da]=h[ja]=h[Ha]=h[Wa]=!1;function Za(t){return O(t)&&lt(t.length)&&!!h[K(t)]}var eo=Za;function ec(t){return function(e){return t(e)}}var to=ec;var ro=typeof exports=="object"&&exports&&!exports.nodeType&&exports,Re=ro&&typeof module=="object"&&module&&!module.nodeType&&module,tc=Re&&Re.exports===ro,rr=tc&&ot.process,rc=function(){try{var t=Re&&Re.require&&Re.require("util").types;return t||rr&&rr.binding&&rr.binding("util")}catch{}}(),nr=rc;var no=nr&&nr.isTypedArray,nc=no?to(no):eo,ft=nc;function oc(t,e){if(!(e==="constructor"&&typeof t[e]=="function")&&e!="__proto__")return t[e]}var Be=oc;var ic=Object.prototype,sc=ic.hasOwnProperty;function ac(t,e,r){var n=t[e];(!(sc.call(t,e)&&V(n,r))||r===void 0&&!(e in t))&&ue(t,e,r)}var oo=ac;function cc(t,e,r,n){var o=!r;r||(r={});for(var i=-1,s=e.length;++i<s;){var a=e[i],c=n?n(r[a],t[a],a,r,t):void 0;c===void 0&&(c=t[a]),o?ue(r,a,c):oo(r,a,c)}return r}var io=cc;function lc(t,e){for(var r=-1,n=Array(t);++r<t;)n[r]=e(r);return n}var so=lc;var uc=9007199254740991,fc=/^(?:0|[1-9]\d*)$/;function dc(t,e){var r=typeof t;return e=e??uc,!!e&&(r=="number"||r!="symbol"&&fc.test(t))&&t>-1&&t%1==0&&t<e}var dt=dc;var hc=Object.prototype,pc=hc.hasOwnProperty;function gc(t,e){var r=Oe(t),n=!r&&ke(t),o=!r&&!n&&ut(t),i=!r&&!n&&!o&&ft(t),s=r||n||o||i,a=s?so(t.length,String):[],c=a.length;for(var u in t)(e||pc.call(t,u))&&!(s&&(u=="length"||o&&(u=="offset"||u=="parent")||i&&(u=="buffer"||u=="byteLength"||u=="byteOffset")||dt(u,c)))&&a.push(u);return a}var ao=gc;function mc(t){var e=[];if(t!=null)for(var r in Object(t))e.push(r);return e}var co=mc;var xc=Object.prototype,bc=xc.hasOwnProperty;function yc(t){if(!x(t))return co(t);var e=ct(t),r=[];for(var n in t)n=="constructor"&&(e||!bc.call(t,n))||r.push(n);return r}var lo=yc;function Cc(t){return fe(t)?ao(t,!0):lo(t)}var ht=Cc;function Tc(t){return io(t,ht(t))}var uo=Tc;function vc(t,e,r,n,o,i,s){var a=Be(t,r),c=Be(e,r),u=s.get(c);if(u){Ae(t,r,u);return}var d=i?i(a,c,r+"",t,e,s):void 0,b=d===void 0;if(b){var B=Oe(c),D=!B&&ut(c),L=!B&&!D&&ft(c);d=c,B||D||L?Oe(a)?d=a:zn(a)?d=Wn(a):D?(b=!1,d=Dn(c,!0)):L?(b=!1,d=Hn(c,!0)):d=[]:Zn(c)||ke(c)?(d=a,ke(a)?d=uo(a):(!x(a)||oe(a))&&(d=Un(c))):b=!1}b&&(s.set(c,d),o(d,c,n,i,s),s.delete(c)),Ae(t,r,d)}var fo=vc;function ho(t,e,r,n,o){t!==e&&_n(e,function(i,s){if(o||(o=new Bn),x(i))fo(t,e,s,r,ho,n,o);else{var a=n?n(Be(t,s),i,s+"",t,e,o):void 0;a===void 0&&(a=i),Ae(t,s,a)}},ht)}var po=ho;function Sc(t){return t}var pt=Sc;function wc(t,e,r){switch(r.length){case 0:return t.call(e);case 1:return t.call(e,r[0]);case 2:return t.call(e,r[0],r[1]);case 3:return t.call(e,r[0],r[1],r[2])}return t.apply(e,r)}var go=wc;var mo=Math.max;function Nc(t,e,r){return e=mo(e===void 0?t.length-1:e,0),function(){for(var n=arguments,o=-1,i=mo(n.length-e,0),s=Array(i);++o<i;)s[o]=n[e+o];o=-1;for(var a=Array(e+1);++o<e;)a[o]=n[o];return a[e]=r(s),go(t,this,a)}}var xo=Nc;function Ec(t){return function(){return t}}var bo=Ec;var Ac=le?function(t,e){return le(t,"toString",{configurable:!0,enumerable:!1,value:bo(e),writable:!0})}:pt,yo=Ac;var kc=800,Oc=16,Rc=Date.now;function Bc(t){var e=0,r=0;return function(){var n=Rc(),o=Oc-(n-r);if(r=n,o>0){if(++e>=kc)return arguments[0]}else e=0;return t.apply(void 0,arguments)}}var Co=Bc;var Lc=Co(yo),To=Lc;function _c(t,e){return To(xo(t,e,pt),t+"")}var vo=_c;function Mc(t,e,r){if(!x(r))return!1;var n=typeof e;return(n=="number"?fe(r)&&dt(e,r.length):n=="string"&&e in r)?V(r[e],t):!1}var So=Mc;function Ic(t){return vo(function(e,r){var n=-1,o=r.length,i=o>1?r[o-1]:void 0,s=o>2?r[2]:void 0;for(i=t.length>3&&typeof i=="function"?(o--,i):void 0,s&&So(r[0],r[1],s)&&(i=o<3?void 0:i,o=1),e=Object(e);++n<o;){var a=r[n];a&&t(e,a,n,i)}return e})}var wo=Ic;var Fc=wo(function(t,e,r){po(t,e,r)}),No=Fc;var Le=class{constructor(e){this.spellcheckService=e}check(e,r){if(!e)return r(null);let n=Rt(e);this.spellcheckService(n,o=>o&&o.length>0?r(null,o):r(null))}};var Pc={A0:"no-break space",2e3:"en quad",2001:"em quad",2002:"en space",2003:"em space",2004:"three-per-em space",2005:"four-per-em space",2006:"six-per-em space",2007:"figure space",2008:"punctuation space",2009:"thin space","200A":"hair space","202F":"narrow no-break space","205F":"medium mathematical space",3e3:"ideographic space"},Dc="\\u2000-\\u200A\\u202F\\u205F\\u3000",jc=new RegExp(`[${Dc}]`,"g"),_e=class{constructor(e){this.marker=e}findMatches(e){return e?[...e.matchAll(jc)].map(n=>this.prepareMatch(n)):void 0}prepareMatch(e){let r=e.index,n=Hc(e[0]),o=Pc[n];return{startIndex:r,endIndex:r+e.length,match:e[0],title:`${o} (\\u${n})`,marker:this.marker}}};function Hc(t){return`${t.charCodeAt(0).toString(16).toUpperCase()}`}var Me=class{constructor(){this.matches=[]}addMatches(e){e?.length&&(this.matches=Wc(this.matches,e))}};function Wc(t,e){let r,n=t.length,o=e.length,i=-1,s=[],a={a1:t,i1:0,a2:e,i2:0};for(;a.i1<n||a.i2<o;)r=$c(a),r.startIndex>=i&&s.push(r),i=r.endIndex;return s}function $c(t){let e=t.i1,r=t.i2,n=t.a1[e],o=t.a2[r];return n&&o&&n.startIndex<o.startIndex?(t.i1=e+1,n):n&&o?(t.i2=r+1,o):n?(t.i1=e+1,n):o?(t.i2=r+1,o):void 0}var Ie=class{constructor(e,r,n){this.editable=e,this.win=e.win,this.focusedEditableHost=void 0,this.currentlyCheckedEditableHost=void 0,this.timeout={};let o={checkOnInit:!1,checkOnFocus:!1,checkOnChange:!0,throttle:1e3,removeOnCorrection:!0,spellcheck:{marker:'<span class="highlight-spellcheck"></span>',throttle:1e3,spellcheckService:function(){}},whitespace:{marker:'<span class="highlight-whitespace"></span>'}};this.config=No({},o,r);let i=this.config.spellcheck.spellcheckService,s=this.config.spellcheck.marker,a=this.config.whitespace.marker,c=y.createMarkerNode(a,"whitespace",this.win);this.spellcheckMarkerNode=y.createMarkerNode(s,"spellcheck",this.win),this.spellcheckService=new Le(i),this.whitespace=new _e(c),this.setupListeners()}setupListeners(){this.config.checkOnFocus&&(this.editable.on("focus",(...e)=>this.onFocus(...e)),this.editable.on("blur",(...e)=>this.onBlur(...e))),(this.config.checkOnChange||this.config.removeOnCorrection)&&this.editable.on("change",(...e)=>this.onChange(...e)),this.config.checkOnInit&&this.editable.on("init",(...e)=>this.onInit(...e))}onInit(e){this.highlight(e)}onFocus(e){this.focusedEditableHost!==e&&(this.focusedEditableHost=e,this.editableHasChanged(e))}onBlur(e){this.focusedEditableHost===e&&(this.focusedEditableHost=void 0)}onChange(e){this.config.checkOnChange&&this.editableHasChanged(e,this.config.throttle),this.config.removeOnCorrection&&this.removeHighlightsAtCursor(e)}editableHasChanged(e,r){this.timeout.id&&this.timeout.editableHost===e&&clearTimeout(this.timeout.id);let n=setTimeout(()=>{this.highlight(e),this.timeout={}},r||0);this.timeout={id:n,editableHost:e}}highlight(e){let r=v.extractText(e);this.spellcheckService.check(r,(n,o)=>{if(n||!e.isConnected)return;let i=v.extractText(e),s=new Me,a=Xr(i,o,this.spellcheckMarkerNode);s.addMatches(a),a=this.whitespace.findMatches(i),s.addMatches(a),this.safeHighlightMatches(e,s.matches)})}safeHighlightMatches(e,r){let n=this.editable.getSelection(e);n?n.retainVisibleSelection(()=>{this.highlightMatches(e,r)}):this.highlightMatches(e,r),this.editable.dispatcher&&this.editable.dispatcher.notify("spellcheckUpdated",e)}highlightMatches(e,r){this.removeHighlights(e),r&&r.length>0&&v.highlightMatches(e,r)}removeHighlights(e){e=Ct(e,this.win.document);for(let r of M('[data-highlight="spellcheck"], [data-highlight="whitespace"]',e))w(r)}removeHighlightsAtCursor(e){e=Ct(e,this.win.document);let r=this.editable.getSelection(e);if(r&&r.isCursor){let n=r.range.startContainer;n.nodeType===3&&(n=n.parentNode);let o;do{if(n===e)return;let i=n.getAttribute("data-highlight");if(i==="spellcheck"||i==="whitespace"){o=n.getAttribute("data-word-id");break}}while(n=n.parentNode);o&&r.retainVisibleSelection(()=>{for(let i of M(`[data-word-id="${o}"]`,e))w(i)})}}};function Q(){if(l.log===!1||!global.console)return;let t=arguments.length===1?arguments[0]:Array.from(arguments);return arguments.length!==1&&t[t.length-1]==="trace"&&(t.pop(),console.trace&&console.trace()),console.log(t)}function or(t){let e=t.win.document;return{focus(r){wt(r)&&r.appendChild(e.createTextNode("\uFEFF"))},blur(r){e.activeElement!==r&&Bt(r)},selection(r,n){Q(n?"Default selection behavior":"Default selection empty behavior")},cursor(r,n){Q(n?"Default cursor behavior":"Default cursor empty behavior")},newline(r,n){if(n.isAtTextEnd()){let o=e.createElement("br");n.insertBefore(o),(o.nextSibling?.nodeType!==3||o.nextSibling.textContent[0]!=="\uFEFF")&&n.insertAfter(e.createTextNode("\uFEFF"))}else n.insertBefore(e.createElement("br"));n.setVisibleSelection()},insert(r,n,o){let i=r.parentNode,s=r.cloneNode(!1);switch(s.id&&s.removeAttribute("id"),n){case"before":i.insertBefore(s,r),r.focus();break;case"after":i.insertBefore(s,r.nextSibling),s.focus();break}},split(r,n,o,i){let s=r.cloneNode(!1);for(s.appendChild(n),r.parentNode.insertBefore(s,r);r.firstChild;)r.removeChild(r.firstChild);r.appendChild(o),G(s),G(r),r.focus()},merge(r,n,o){let i,s;switch(n){case"before":i=qt(r),s=r;break;case"after":i=r,s=Vt(r);break}i&&s&&(o=i.childNodes.length>0?t.appendTo(i,s.innerHTML):t.prependTo(i,s.innerHTML),s.remove(),o.save(),G(i),o.restore(),o.setVisibleSelection())},empty(r){Q("Default empty behavior")},switch(r,n,o){switch(n){case"before":let i=qt(r);i&&(o.moveAtTextEnd(i),o.setVisibleSelection());break;case"after":let s=Vt(r);s&&(o.moveAtBeginning(s),o.setVisibleSelection());break}},move(r,n,o){Q("Default move behavior")},paste(r,n,o){if(n.length===0)return;if(o.insertBefore(n.shift()),n.length===0)return o.setVisibleSelection();let i=r.parentNode,s=r;n.forEach(a=>{let c=r.cloneNode(!1);c.id&&c.removeAttribute("id");let u=I(a);c.appendChild(u),i.insertBefore(c,s.nextSibling),s=c}),t.createCursorAtEnd(s).setVisibleSelection()},clipboard(r,n,o){Q("Default clipboard behavior")},toggleBold(r){r.toggleBold()},toggleEmphasis(r){r.toggleEmphasis()}}}function ir(t){let e=or(t);return{focus(r){e.focus(r)},blur(r){e.blur(r)},flow(r,n){e.flow(r,n)},selection(r,n){e.selection(r,n)},cursor(r,n){e.cursor(r,n)},newline(r,n){e.newline(r,n)},split(r,n,o,i){e.split(r,n,o,i)},insert(r,n,o){e.insert(r,n,o)},merge(r,n,o){e.merge(r,n,o)},empty(r){e.empty(r)},switch(r,n,o){e.switch(r,n,o)},move(r,n,o){e.move(r,n,o)},clipboard(r,n,o){e.clipboard(r,n,o)},paste(r,n,o){e.paste(r,n,o)},toggleBold(r){e.toggleBold(r)},toggleEmphasis(r){e.toggleEmphasis(r)}}}function Fe(t){return[...new T(t,"getNextTextNode")]}function gt({textNodes:t,absOffset:e}){let r=0,n=0,o;for(let i=0;i<t.length;i++){let s=t[i];if(e<=r+s.textContent.length){o=s,n=e-r;break}r+=s.textContent.length}return{node:o,relativeOffset:n}}function Eo(t){let e=Fe(t),r=(n,o)=>n+o.textContent.length;return e.reduce(r,0)}function Ro({host:t,requiredOnFirstLine:e,requiredOnLastLine:r,positionX:n}){let o=t.ownerDocument.createRange();o.selectNodeContents(t);let i=o.getBoundingClientRect(),s=Eo(t),a=Fe(t);if(s===0)return{wasFound:!1};let c={currentOffset:Math.floor(s/2),leftLimit:0,rightLimit:s},u=c.currentOffset,d,b=20;for(;c.leftLimit<c.rightLimit&&b>0;){b=b-=1,u=c.currentOffset;let _=Oo({textNodes:a,offset:c.currentOffset}).getBoundingClientRect();if(d=Math.abs(_.left-n),e&&i.top!==_.top){Ao(c);continue}else if(r&&i.bottom!==_.bottom){ko(c);continue}n<_.left?Ao(c):ko(c)}let D=Oo({textNodes:a,offset:c.currentOffset}).getBoundingClientRect(),L=Math.abs(D.left-n);return L<d&&(d=L,u=c.currentOffset),{distance:d,offset:u,wasFound:!0}}function Ao(t){t.rightLimit=t.currentOffset,t.currentOffset=Math.floor((t.currentOffset+t.leftLimit)/2)}function ko(t){t.leftLimit=t.currentOffset,t.currentOffset=Math.ceil((t.currentOffset+t.rightLimit)/2)}function Oo({textNodes:t,offset:e}){let{node:r,relativeOffset:n}=gt({textNodes:t,absOffset:e}),o=r.ownerDocument.createRange();return o.setStart(r,n),o.collapse(!0),o}var X=class{constructor(e){let r={window,defaultBehavior:!0,mouseMoveSelectionChanges:!1,browserSpellcheck:!0};this.config=Object.assign(r,e),this.win=this.config.window,this.editableSelector=`.${l.editableClass}`,this.dispatcher=new Ne(this),this.config.defaultBehavior===!0&&this.dispatcher.on(ir(this))}static getGlobalConfig(){return l}static globalConfig(e){Object.assign(l,e),Xt(l)}add(e,r){return this.enable(e,r),this}remove(e){let r=M(e,this.win.document);this.disable(r);for(let n of r)n.classList.remove(l.editableDisabledClass);return this}disable(e){let r=M(e||`.${l.editableClass}`,this.win.document);for(let n of r)Rr(n);return this}enable(e,r){let{normalize:n=typeof r=="boolean"?r:!1,plainText:o=!1}=r??{},i=this.config.browserSpellcheck,s=M(e||`.${l.editableDisabledClass}`,this.win.document);for(let a of s)Or(a,{normalize:n,plainText:o,shouldSpellcheck:i}),this.dispatcher.notify("init",a);return this}suspend(e){let r=M(e||`.${l.editableClass}`,this.win.document);for(let n of r)n.removeAttribute("contenteditable");return this.dispatcher.suspend(),this}continue(e){let r=M(e||`.${l.editableClass}`,this.win.document);for(let n of r)n.setAttribute("contenteditable",!0);return this.dispatcher.continue(),this}createCursor(e,r="beginning"){let n=p.findHost(e,this.editableSelector);if(!n)return;let o=m();return r==="beginning"||r==="end"?(o.selectNodeContents(e),o.collapse(r==="beginning")):e!==n?r==="before"?(o.setStartBefore(e),o.setEndBefore(e)):r==="after"&&(o.setStartAfter(e),o.setEndAfter(e)):S("EditableJS: cannot create cursor outside of an editable block."),new p(n,o)}createCursorAtCharacterOffset({element:e,offset:r}){let n=Fe(e),{node:o,relativeOffset:i}=gt({textNodes:n,absOffset:r}),s=m();s.setStart(o,i),s.collapse(!0);let a=p.findHost(e,this.editableSelector),c=new p(a,s);return c.setVisibleSelection(),c}createCursorAtBeginning(e){return this.createCursor(e,"beginning")}createCursorAtEnd(e){return this.createCursor(e,"end")}createCursorBefore(e){return this.createCursor(e,"before")}createCursorAfter(e){return this.createCursor(e,"after")}getContent(e){return Xe(e)}appendTo(e,r){let n=ee(e,this.win.document),o=this.createCursor(n,"end");return o.insertAfter(typeof r=="string"?I(r):r),o}prependTo(e,r){let n=ee(e,this.win.document),o=this.createCursor(n,"beginning");return o.insertBefore(typeof r=="string"?I(r):r),o}getSelection(e){let r=this.dispatcher.selectionWatcher.getFreshSelection();if(!e||!r)return r;let n=r.range;if(e?.isConnected&&gr(e,n))return r}setupHighlighting(e){return this.highlighting=new Ie(this,e),this}setupSpellcheck(e){let r;e.markerNode&&(r=e.markerNode.outerHTML),this.setupHighlighting({throttle:e.throttle,spellcheck:{marker:r,spellcheckService:e.spellcheckService}}),this.spellcheck={checkSpelling:n=>{this.highlighting.highlight(n)}}}highlight({editableHost:e,text:r,highlightId:n,textRange:o,raiseEvents:i,type:s="comment"}){return o?typeof o.start!="number"||typeof o.end!="number"?(S("Error in Editable.highlight: You passed a textRange object with invalid keys. Expected shape: { start: Number, end: Number }"),-1):o.start===o.end?(S("Error in Editable.highlight: You passed a textRange object with equal start and end offsets, which is considered a cursor and therefore unfit to create a highlight."),-1):y.highlightRange(e,r,n,o.start,o.end,i?this.dispatcher:void 0,s):y.highlightText(e,r,n,s,i?this.dispatcher:void 0)}getHighlightPositions({editableHost:e,type:r}){return y.extractHighlightedRanges(e,r)}removeHighlight({editableHost:e,highlightId:r,raiseEvents:n}){y.removeHighlight(e,r,n?this.dispatcher:void 0)}decorateHighlight({editableHost:e,highlightId:r,addCssClass:n,removeCssClass:o}){y.updateHighlight(e,r,n,o)}on(e,r){return this.dispatcher.on(e,r),this}off(...e){return this.dispatcher.off.apply(this.dispatcher,e),this}unload(){return this.dispatcher.unload(),this}findClosestCursorOffset({element:e,origCoordinates:r,requiredOnFirstLine:n=!1,requiredOnLastLine:o=!1}){let i=this.dispatcher.switchContext?this.dispatcher.switchContext.positionX:r.left;return Ro({host:e,requiredOnFirstLine:n,requiredOnLastLine:o,positionX:i})}};X.parser=W;X.content=N;["focus","blur","flow","selection","cursor","newline","insert","split","merge","empty","change","switch","move","clipboard","paste","spellcheckUpdated","selectToBoundary"].forEach(t=>{X.prototype[t]=function(e){return this.on(t,e)}});var R=new X({defaultBehavior:!1}),Vc=["blur","change","clipboard","cursor","empty","flow","focus","insert","merge","move","newline","paste","selection","selectToBoundary","spellcheckUpdated","split","switch"];Vc.forEach(t=>{R.on(t,(e,...r)=>{let n=new CustomEvent(`editable-${t}`,{detail:r});e.dispatchEvent(n)})});var mt=[];function sr(t){if(!(t instanceof Element))return null;let e=mt.find(n=>n.el===t);if(e)return e;let r={el:t,disabled:!1,suspended:!1};return mt.push(r),r}function qc(t,e,r){let{cleanup:n,evaluateLater:o,effect:i}=r,s=sr(t);R.add(t),s.disabled&&R.disable(t),s.suspended&&R.suspend(t);let a=o(e);i(()=>{a(c=>{if(document.activeElement===t)return;let u=c||"";t.innerHTML!==u&&(t.innerHTML=u)})}),n(()=>{R.remove(t),mt=mt.filter(c=>c!==s)})}function Uc(t,e,r){let{evaluateLater:n,effect:o}=r,i=sr(t),s=n(e);o(()=>{s(a=>{a?R.disable(t):R.enable(t),i.disabled=a})})}function Kc(t,e,r){let{evaluateLater:n,effect:o}=r,i=sr(t),s=n(e);o(()=>{s(a=>{a?R.suspend(t):R.continue(t),i.suspended=a})})}function Bo(t){t.directive("editable",(e,{value:r,expression:n},o)=>{r==="disabled"?Uc(e,n,o):r==="suspended"?Kc(e,n,o):r?console.warn(`[alpine-editable] unknown directive x-editable:${r}`):qc(e,n,o)}),t.magic("editable",()=>R)}document.addEventListener("alpine:init",()=>{window.Alpine.plugin(Bo)});})();
